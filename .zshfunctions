#!/usr/bin/env zsh

function genpasswd {
    pwgen -Bs $1 1 | tr -d '\n' | pbcopy | pbpaste; echo “Has been copied to clipboard”
}

##### GCP #####
gcpinstances=('julien-node-jrx-1' 'julien-node-jrx-2' 'julien-node-jrx-3' 'julien-loader')
gcpzone='us-west1-b'

function dssh {
    instance=$gcpinstances[$1]
    echo "SSHing to $instance"
    gssh $instance
}

function dstop {
    demo stop
}

function dstart {
    demo start
}

function dlist {
    glist | grep julien
}

function gssh {
    gcloud compute ssh $1 --zone $gcpzone
}

function gstop {
    ginstances stop $1
}

function gstart {
    ginstances start $1
}

function glist {
    gcloud compute instances list
}

function ginstances {
    gcloud compute instances $1 --quiet --async $2 --zone $gcpzone
}

function demo {
    for instance in $gcpinstances; do
        ginstances $1 $instance
    done
}

##### dev #####
function mtier() {
  read host port <<< $( echo $1 | awk -F":" '{print $1" "$2}' )
  cmd="memtier_benchmark --ratio=1:4 --test-time=24000 -d 100 -t 10 -c 5 --pipeline=50 --key-pattern=S:S -x 10 --hide-histogram -s $host -p $port"
  echo $cmd
  $cmd
}

function tfield {
    terraform output $1 | pbcopy
}

function start-redisearch {
    redis-server /usr/local/redis/redis.conf --loadmodule /Users/jruaux/git/RediSearch/build/redisearch.so
}

function start-redisgraph {
    redis-server /usr/local/redis/redis.conf --loadmodule /Users/jruaux/git/RedisGraph/src/redisgraph.so
}

function start-prometheus {
    prometheus --config.file=/Users/jruaux/dev/prometheus/prometheus.yml
}

##### Backup #####
function backup-pics {
    rsync --remove-source-files -azv ~/Pictures/Photos\ Library.photoslibrary/Masters/ nas:/tank/pictures/jrx/
}

function backup-music {
    rsync --remove-source-files -azv ~/Music/Soulseek/complete/ nas:/tank/music/new/
    find /Users/jruaux/Music/Soulseek/complete/ -type d -empty -delete
}

function ex2ssh {
    ssh -oHostKeyAlgorithms=+ssh-dss root@ex2
}
